{% extends 'app.html' %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">

<div class="container">
  <!-- Sidebar -->
  <nav class="sidebar" id="sidebar">
    <h3>Admin Menu</h3>
    <a onclick="showSection('admins')" id="link-admins"><span class="icon">ðŸ‘¤</span> Admin List</a>
    <a onclick="showSection('doctors')" id="link-doctors"><span class="icon">ðŸ©º</span> Doctors</a>
    <a onclick="showSection('appointments')" id="link-appointments"><span class="icon">ðŸ“…</span> Appointment List</a>
    <a onclick="showSection('users')" id="link-users"><span class="icon">ðŸ§‘</span> User List</a>
    <a onclick="showSection('donors')" id="link-donors"><span class="icon">ðŸ’‰</span> Donor List</a>
    <a onclick="showSection('contact_messages')" id="link-contact_messages"><span class="icon">ðŸ’Œ</span> Contact List</a>

    <!-- Power BI menu -->
    <a onclick="togglePowerBIMenu()" id="link-powerbi"><span class="icon">ðŸ“Š</span> Power BI</a>
    <div id="powerbi-submenu" style="display:none; padding-left: 20px;">
      <a onclick="loadPowerBIImage('pbi_diabetic.png')">Diabetes</a>
      <a onclick="loadPowerBIImage('pbi_heart.png')">Heart</a>
    </div>

    <a href="{{ url_for('logout') }}"><span class="icon">ðŸšª</span> Logout</a>
  </nav>

  <!-- Main Content -->
  <section class="main-content">
    <h1>Welcome, {{ admin_email }} ðŸ‘‹</h1>
    <hr>

    <!-- Admin List -->
    <div id="admins" class="list-section">
      <h2>Admin List</h2>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Email</th>
            <th>Created At</th>
          </tr>
        </thead>
        <tbody>
          {% for admin in admins %}
          <tr>
            <td>{{ admin.id }}</td>
            <td>{{ admin.username }}</td>
            <td>{{ admin.email }}</td>
            <td>{{ admin.created_at }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Appointment List -->
    <div id="appointments" class="list-section">
      <h2>Appointment List</h2>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Date</th>
            <th>Time</th>
            <th>Doctor</th>
          </tr>
        </thead>
        <tbody>
          {% for app in appointments %}
          <tr>
            <td>{{ app.id }}</td>
            <td>{{ app.name }}</td>
            <td>{{ app.email }}</td>
            <td>{{ app.phone }}</td>
            <td>{{ app.date }}</td>
            <td>{{ app.time }}</td>
            <td>{{ app.doctor }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- User List -->
    <div id="users" class="list-section">
      <h2>User List</h2>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr>
            <td>{{ user.id }}</td>
            <td>{{ user.name }}</td>
            <td>{{ user.email }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Donor List -->
    <div id="donors" class="list-section">
      <h2>Donor List</h2>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Blood Group</th>
          </tr>
        </thead>
        <tbody>
          {% for donor in donors %}
          <tr>
            <td>{{ donor.id }}</td>
            <td>{{ donor.donor_name }}</td>
            <td>{{ donor.email }}</td>
            <td>{{ donor.phone }}</td>
            <td>{{ donor.blood_group }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Contact Messages -->
    <div id="contact_messages" class="list-section">
      <h2>Contact List</h2>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Message</th>
            <th>Submitted At</th>
          </tr>
        </thead>
        <tbody>
          {% for msg in contact_messages %}
          <tr>
            <td>{{ msg.id }}</td>
            <td>{{ msg.name }}</td>
            <td>{{ msg.email }}</td>
            <td>{{ msg.message }}</td>
            <td>{{ msg.submitted_at }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Doctors Section -->
    <div id="doctors" class="list-section">
      <h2>Doctors List</h2>
      <button onclick="showForm()">Add Doctor</button>

      <!-- Doctor Form (hidden by default) -->
      <div id="doctor-form" style="display:none; margin-top: 15px;">
        <form action="{{ url_for('add_doctor') }}" method="POST" enctype="multipart/form-data">
          <label>Name:</label><br>
          <input type="text" name="name" required><br>
          <label>Email:</label><br>
          <input type="email" name="email" required><br>
          <label>Phone:</label><br>
          <input type="text" name="phone" required><br>
          <label>Specialty:</label><br>
          <input type="text" name="specialty" required><br>
          <label>Photo:</label><br>
          <input type="file" name="photo" required><br><br>
          <button type="submit">Add Doctor</button>
        </form>
      </div>

      <table border="1" style="margin-top:10px;">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Specialty</th>
            <th>Photo</th>
          </tr>
        </thead>
        <tbody>
          {% for doc in doctors %}
          <tr>
            <td>{{ doc.id }}</td>
            <td>{{ doc.name }}</td>
            <td>{{ doc.email }}</td>
            <td>{{ doc.phone }}</td>
            <td>{{ doc.specialty }}</td>
            <td>
              {% if doc.image %}
              <img src="{{ url_for('static', filename='img/' ~ doc.image) }}" width="60">
              {% else %}
              N/A
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Power BI Section -->
    <div id="powerbi" class="list-section">
      <h2 id="powerbi-title">Power BI Dashboard</h2>
      <div class="powerbi-container">
        <img id="powerbi-frame" src="" alt="Power BI Dashboard" style="width:100%; height:100%; object-fit:contain; border-radius:16px; border:3px solid #4a90e2;">
      </div>
    </div>

  </section>
</div>

<script>
  function showForm() {
    let form = document.getElementById('doctor-form');
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
  }

  const links = document.querySelectorAll('.sidebar a');

  function showSection(id) {
    document.querySelectorAll('.list-section').forEach(s => s.style.display = 'none');
    links.forEach(link => link.classList.remove('active'));
    document.getElementById(id).style.display = 'block';
    document.getElementById('link-' + id).classList.add('active');
  }

  function togglePowerBIMenu() {
    const submenu = document.getElementById('powerbi-submenu');
    submenu.style.display = submenu.style.display === 'none' ? 'block' : 'none';
  }

  function loadPowerBIImage(fileName) {
    const frame = document.getElementById('powerbi-frame');
    frame.src = "{{ url_for('static', filename='img') }}/" + fileName; 

    // Update title
    const title = fileName.split('.')[0];
    document.getElementById('powerbi-title').textContent = 
        title.charAt(0).toUpperCase() + title.slice(1) + " Dashboard";

    // Show Power BI section
    document.querySelectorAll('.list-section').forEach(s => s.style.display = 'none');
    document.getElementById('powerbi').style.display = 'block';

    // Highlight sidebar
    document.querySelectorAll('.sidebar a').forEach(link => link.classList.remove('active'));
    document.getElementById('link-powerbi').classList.add('active');
  }

  window.onload = () => showSection('admins'); // default
</script>

{% endblock %}
